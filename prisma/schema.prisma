// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// Enum 타입 정의
// ============================================

/// 특성 타입: 적성 또는 흥미
enum TraitType {
  APTITUDE  // 적성
  INTEREST  // 흥미
}

/// 입시 전형 타입: 일반전형 또는 특별전형
enum AdmissionType {
  GENERAL  // 일반전형
  SPECIAL  // 특별전형
}

// ============================================
// 모델 정의
// ============================================

/// 사용자 모델: 진로 매칭 서비스를 이용하는 사용자
model User {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  /// 사용자의 특성 점수 목록
  userTraits UserTrait[]

  @@map("users")
}

/// 학교 모델: 마이스터고 및 특성화고등학교 정보
model School {
  id        String   @id @default(cuid())
  name      String   // 학교명
  /// 학교 유형 (MEISTER: 마이스터고, SPECIALIZED: 특성화고, GENERAL: 일반고)
  schoolType String  @default("SPECIALIZED") @map("school_type")
  /// 설립유형 (공립, 사립 등)
  foundationType String @map("foundation_type")
  /// 마이스터고 지정차수 (예: 1차, 2차 등)
  designationTh  String  @map("designation_th")
  address   String?  // 주소
  region    String?  // 지역 (시도명)
  phone     String?  // 전화번호
  homepage  String?  // 홈페이지 주소
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  /// 학교에 속한 학과 목록
  departments Department[]

  @@index([name])
  @@index([schoolType])
  @@index([foundationType])
  @@index([designationTh])
  @@map("schools")
}

/// 학과 모델: 학교에 속한 학과 정보
model Department {
  id          String   @id @default(cuid())
  name        String   // 학과명
  description String?  // 학과 설명
  /// 소속 학교 ID
  schoolId    String   @map("school_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  /// 소속 학교
  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  /// 학과의 입시전형 목록
  admissionRules AdmissionRule[]
  /// 학과의 목표기업 목록
  targetCompanies TargetCompany[]
  /// 학과별 특성 가중치 목록
  departmentTraits DepartmentTrait[]

  @@index([name])
  @@index([schoolId])
  @@map("departments")
}

/// 입시전형 모델: 학과별 입시 전형 정보 및 반영 비율
model AdmissionRule {
  id            String        @id @default(cuid())
  /// 전형 구분 (일반전형/특별전형)
  admissionType AdmissionType @map("admission_type")
  /// 연도
  year          Int
  /// 내신 반영 비율 (%)
  gpaRatio      Float?        @map("gpa_ratio")
  /// 면접 반영 비율 (%)
  interviewRatio Float?       @map("interview_ratio")
  /// 필기 반영 비율 (%)
  writtenRatio  Float?        @map("written_ratio")
  /// 적성검사 반영 비율 (%)
  aptitudeRatio Float?        @map("aptitude_ratio")
  /// 출석 반영 비율 (%)
  attendanceRatio Float?      @map("attendance_ratio")
  /// 전형 설명
  description  String?
  /// 소속 학과 ID
  departmentId  String        @map("department_id")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  /// 소속 학과
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([admissionType])
  @@index([year])
  @@map("admission_rules")
}

/// 목표기업 모델: 학과별 주요 취업처 정보
model TargetCompany {
  id            String   @id @default(cuid())
  /// 기업명
  name          String
  /// 산업/기업유형 (예: 공기업, 대기업 등)
  industryType  String
  /// 소속 학과 ID
  departmentId  String   @map("department_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  /// 소속 학과
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([name])
  @@map("target_companies")
}

/// 특성 모델: 적성 또는 흥미 특성을 나타내는 태그
model Trait {
  id        String   @id @default(cuid())
  name      String   // 특성명
  /// 특성 타입 (적성/흥미)
  type      TraitType
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  /// 이 특성을 가진 학과별 가중치 목록
  departmentTraits DepartmentTrait[]
  /// 이 특성을 가진 사용자 점수 목록
  userTraits UserTrait[]

  @@unique([name, type])
  @@index([type])
  @@map("traits")
}

/// 학과별 특성 가중치 모델: 특정 학과가 어떤 특성을 중요하게 여기는지 저장
model DepartmentTrait {
  id           String  @id @default(cuid())
  /// 가중치 (0.0 ~ 1.0 또는 0 ~ 100 등)
  weight       Float
  /// 소속 학과 ID
  departmentId String  @map("department_id")
  /// 특성 ID
  traitId      String  @map("trait_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  /// 소속 학과
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  /// 특성
  trait Trait @relation(fields: [traitId], references: [id], onDelete: Cascade)

  @@unique([departmentId, traitId])
  @@index([departmentId])
  @@index([traitId])
  @@map("department_traits")
}

/// 사용자 특성 모델: 사용자의 테스트 결과 점수 저장
model UserTrait {
  id        String   @id @default(cuid())
  /// 점수 (0.0 ~ 1.0 또는 0 ~ 100 등)
  score     Float
  /// 사용자 ID
  userId    String   @map("user_id")
  /// 특성 ID
  traitId   String   @map("trait_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  /// 사용자
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  /// 특성
  trait Trait @relation(fields: [traitId], references: [id], onDelete: Cascade)

  @@unique([userId, traitId])
  @@index([userId])
  @@index([traitId])
  @@map("user_traits")
}

